# Brainstorming: 上下文摘要系统优化

## 问题陈述

OpenClaw 需要一个智能的上下文摘要系统，让第二大脑（Deep-Sea Nexus）通过每次对话的知识沉淀变得越来越聪明。

### 当前状态
- ✅ 有摘要格式规范 (`## 📋 总结`)
- ✅ 有向量库存储 (2219 条)
- ✅ 有基本摘要解析

### 缺失部分
- ❌ 缺乏高质量摘要生成机制
- ❌ 摘要缺乏结构化字段
- ❌ 知识沉淀模式不清晰

---

## 设计目标

### 核心目标
1. **知识可复用** - 未来检索时能快速理解上下文
2. **避免冗余** - 不生成"正确的废话"
3. **自我进化** - 知识积累让系统越来越聪明
4. **低开销** - 通过系统提示词触发，无需额外代码

---

## 方案设计

### 核心思路
通过**系统提示词**让 LLM 每次回复时自动生成结构化摘要，而不是事后用代码检测。

### 摘要字段设计

```json
{
  "本次核心产出": "一句话说明这次对话解决了什么问题",
  "技术要点": ["要点1", "要点2"],
  "代码模式": "提取的可复用代码模式",
  "决策上下文": "为什么做这个选择（而非其他方案）",
  "避坑记录": "未来应避免的错误/弯路",
  "适用场景": "这个方案适用的场景描述",
  "搜索关键词": ["标签1", "标签2"],
  "项目关联": "所属项目（如果有）",
  "置信度": "high/medium/low (摘要质量自评)"
}
```

### 字段设计理由

| 字段 | 目的 | 避免问题 |
|------|------|----------|
| 本次核心产出 | 快速理解对话价值 | 摘要流水账 |
| 技术要点 | 结构化知识 | 信息碎片化 |
| 代码模式 | 代码复用 | 每次重复写 |
| 决策上下文 | 理解"为什么" | 盲目套用 |
| 避坑记录 | 避免重复犯错 | 同坑跳多次 |
| 适用场景 | 避免滥用 | 不分场景乱用 |
| 搜索关键词 | 精准检索 | 检索不到 |
| 项目关联 | 项目连续性 | 上下文断裂 |
| 置信度 | 质量自检 | 低质量沉淀 |

---

## 实施路径

### Step 1: 设计系统提示词
设计 LLM 友好的摘要生成提示词

### Step 2: 修改 auto_summary.py
集成新的摘要格式和字段

### Step 3: 修改向量库存储
确保新字段能存入并被检索

### Step 4: 测试验证
验证摘要质量和检索效果

---

## 风险与对策

| 风险 | 对策 |
|------|------|
| LLM 拒绝生成 | 提示词要简洁，明确这是"帮助未来自己" |
| 摘要太泛 | 加入"避免泛泛而谈"的约束 |
| 字段不完整 | 允许部分字段为空，但核心字段必填 |
| 向量检索不精准 | 优化关键词提取 |

---

## 成功标准

1. ✅ 每次对话都生成结构化摘要
2. ✅ 摘要能精准被检索到
3. ✅ 知识可复用于未来对话
4. ✅ 长期积累让第二大脑越来越聪明

---

*Plan Version: 1.0*  
*Created: 2026-02-13*