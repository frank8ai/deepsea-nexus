# Deep-Sea Nexus v2.0 产品规格说明书 (PRD)

```
================================================================================
                    Deep-Sea Nexus v2.0
                    产品规格说明书 (PRD)
================================================================================

文档版本: 2.0.0
创建日期: 2026-02-07
状态: 规划完成，待开发

================================================================================
                                目录
================================================================================

1. 产品概述
2. 设计目标
3. 系统架构
4. 功能规格
5. 数据规格
6. API 接口
7. 集成规格
8. 非功能规格
9. 测试规格
10. 部署规格
11. 里程碑

================================================================================
1. 产品概述
================================================================================

1.1 产品定位
-----------

Deep-Sea Nexus v2.0 是一个专为 AI Agent 设计的长期记忆系统。

核心定位：
- 极轻量：启动 < 300 tokens
- 按需加载：对话 < 1000 tokens
- 零依赖：纯 Python 实现
- 原生集成：与 OpenClaw 无缝对接

1.2 解决的问题
--------------

| 问题 | v1.0 | v2.0 |
|------|------|------|
| 启动加载 | ~50K tokens | < 300 tokens ✅ |
| 每轮对话 | ~5000 tokens | < 1000 tokens ✅ |
| 记忆查询 | 全文搜索 | 索引优先 ✅ |
| 数据归档 | 无 | 自动 Flush ✅ |
| 关键词标记 | 无 | #GOLD ✅ |

1.3 目标用户
-----------

- AI Agent 开发者
- OpenClaw 用户
- 需要长期记忆的对话系统

================================================================================
2. 设计目标
================================================================================

2.1 核心指标
-----------

| 指标 | 目标值 | 验收方法 |
|------|--------|----------|
| 启动加载 | < 300 tokens | 统计索引文件大小 |
| 每轮对话 | < 1000 tokens | 实际 Token 计数 |
| 索引大小 | < 300 tokens | 文件大小验证 |
| 召回延迟 | < 100ms | 性能测试 |
| 召回准确率 | > 80% | 人工验证 |

2.2 设计原则
-----------

P1. 索引优先
  - 启动只读索引
  - 索引包含所有 Session 摘要
  - 关键词可快速定位

P2. 按需加载
  - 只加载相关 Session
  - 只加载相关内容片段
  - 不注入完整上下文

P3. GOLD 标记
  - 关键信息实时标记
  - GOLD 信息索引优先
  - 防止信息丢失

P4. 自动归档
  - 每日自动 Flush
  - 历史按月归档
  - 磁盘空间可控

P5. 零依赖
  - 纯 Python 标准库
  - 无外部向量库
  - 无 Embedding 模型

2.3 约束条件
-----------

C1. 兼容性
  - 兼容 OpenClaw 当前版本
  - 兼容现有记忆文件
  - 渐进式迁移

C2. 安全性
  - 本地存储
  - 无网络依赖
  - 用户数据不出本地

C3. 性能
  - 启动 < 1 秒
  - 召回 < 100ms
  - 内存 < 50MB

================================================================================
3. 系统架构
================================================================================

3.1 整体架构图
-------------

┌─────────────────────────────────────────────────────────────────────────────┐
│                         Deep-Sea Nexus v2.0                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        OpenClaw Agent                                │   │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐        │   │
│  │  │  对话管理  │  │  任务规划  │  │  工具调用  │  │  记忆管理  │        │   │
│  │  └─────┬─────┘  └─────┬─────┘  └─────┬─────┘  └─────┬─────┘        │   │
│  │        │              │              │              │                 │   │
│  └────────┼──────────────┼──────────────┼──────────────┼─────────────────┘   │
│           │              │              │              │                      │
│           └──────────────┴──────────────┴──────────────┘                       │
│                                      │                                       │
│                                      ▼                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        Nexus Core API                               │   │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐        │   │
│  │  │ start_    │  │ write_    │  │ recall   │  │ daily_    │        │   │
│  │  │ session   │  │ session   │  │          │  │ flush     │        │   │
│  │  └───────────┘  └───────────┘  └───────────┘  └───────────┘        │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                      │                                       │
│                                      ▼                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        存储层                                        │   │
│  │                                                                     │   │
│  │   ┌─────────────────┐     ┌─────────────────┐                     │   │
│  │   │    索引文件      │     │   Session 文件  │                     │   │
│  │   │  _DAILY_INDEX   │     │  session_*.md   │                     │   │
│  │   │     (<300t)     │     │                 │                     │   │
│  │   └─────────────────┘     └─────────────────┘                     │   │
│  │                                                                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

3.2 模块划分
-----------

┌────────────────────────────────────────┐
│             Nexus Core                 │
├────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────────┐ │
│  │ ConfigMgr  │  │ SessionMgr      │ │
│  │ 配置管理    │  │ Session 管理    │ │
│  └─────────────┘  └─────────────────┘ │
│  ┌─────────────┐  ┌─────────────────┐ │
│  │ IndexMgr   │  │ RecallEngine    │ │
│  │ 索引管理    │  │ 召回引擎        │ │
│  └─────────────┘  └─────────────────┘ │
│  ┌─────────────┐  ┌─────────────────┐ │
│  │ FlushMgr   │  │ StatsCollector  │ │
│  │ Flush 管理  │  │ 统计收集        │ │
│  └─────────────┘  └─────────────────┘ │
└────────────────────────────────────────┘

3.3 数据流
---------

启动流程：
  1. 加载 config.yaml
  2. 创建目录结构
  3. 加载今日索引
  4. 返回索引 (< 300 tokens)

对话流程：
  1. 用户提问
  2. 搜索索引关键词
  3. 定位相关 Session
  4. 加载相关内容 (< 500 tokens)
  5. 返回结果

写入流程：
  1. 追加到 Session 文件
  2. 如有 #GOLD，同步更新索引
  3. 更新最后活跃时间

Flush 流程：
  1. 每日定时触发
  2. 收集所有 Session
  3. 移动到月度归档
  4. 创建新索引

================================================================================
4. 功能规格
================================================================================

4.1 功能清单
-----------

F1. Session 管理
  - [F1.1] 创建 Session
  - [F1.2] 写入 Session
  - [F1.3] 读取 Session
  - [F1.4] 关闭 Session
  - [F1.5] 自动分割大文件

F2. 索引管理
  - [F2.1] 创建每日索引
  - [F2.2] 更新索引
  - [F2.3] 解析索引
  - [F2.4] 搜索索引关键词

F3. 召回系统
  - [F3.1] 关键词搜索
  - [F3.2] GOLD 优先
  - [F3.3] 多结果返回
  - [F3.4] 相关度排序

F4. GOLD 标记
  - [F4.1] 内容标记
  - [F4.2] 关键词提取
  - [F4.3] 索引同步

F5. 自动 Flush
  - [F5.1] 定时 Flush
  - [F5.2] 手动 Flush
  - [F5.3] 月度归档

F6. 系统统计
  - [F6.1] Session 统计
  - [F6.2] 索引大小
  - [F6.3] 使用报告

4.2 功能详情
-----------

F1.1 创建 Session
-----------------

描述：开始一个新的会话

输入：
  - topic: 字符串，话题名称
  - auto_create: 布尔值，是否创建文件（默认 True）

输出：
  - session_id: 字符串，格式 "HHMM_Topic"

流程：
  1. 生成 Session ID（时间 + 话题）
  2. 创建 Session 文件
  3. 写入 YAML 头部
  4. 添加到今日索引

示例：
  输入: topic = "Python 学习"
  输出: session_id = "0923_Python"

验收标准：
  - Session ID 唯一
  - 文件正确创建
  - 索引正确更新

---

F1.2 写入 Session
-----------------

描述：向 Session 追加内容

输入：
  - session_id: 字符串
  - content: 字符串，内容
  - is_gold: 布尔值，是否为 GOLD 标记
  - append: 布尔值，是否追加（默认 True）

输出：
  - bool: 是否成功

流程：
  1. 检查 Session 文件存在
  2. 读取现有内容
  3. 追加新内容
  4. 写入文件
  5. 如 is_gold=True，同步更新索引

示例：
  输入: content = "今天学习了列表推导式"
  输出: True

验收标准：
  - 内容正确追加
  - GOLD 正确同步到索引

---

F1.3 读取 Session
-----------------

描述：读取 Session 内容

输入：
  - session_id: 字符串
  - max_tokens: 整数，最大 tokens（默认 1000）

输出：
  - str: Session 内容（可能被截断）

流程：
  1. 查找 Session 文件
  2. 读取内容
  3. 按 max_tokens 截断
  4. 返回

示例：
  输入: session_id = "0923_Python", max_tokens = 500
  输出: "[截断后的内容...]"

验收标准：
  - 正确返回内容
  - 截断正确

---

F2.1 创建每日索引
-----------------

描述：创建新的每日索引文件

输入：
  - date: 字符串，日期 YYYY-MM-DD

输出：
  - 文件创建

文件格式：
```yaml
---
uuid: XXXXXX
type: daily-index
tags: [daily-index, 2026-02-07]
created: 2026-02-07
---

# 2026-02-07 Daily Index

## Sessions (0)
_(no active sessions)_

## Gold Keys (0)
_(no gold keys)_

## Topics (0)
_(no topics)_
```

验收标准：
- 文件格式正确
- < 300 tokens

---

F2.4 搜索索引关键词
-------------------

描述：在索引中搜索关键词

输入：
  - query: 字符串，搜索词
  - session_list: Dict，Session 列表
  - gold_keys: List，GOLD 关键词列表

输出：
  - List[Dict]: [{id, topic, score, is_gold}]

评分规则：
  - 匹配 topic: +1 分
  - 匹配 session_id: +0.5 分
  - GOLD 匹配: +1.5 分

示例：
  输入: query = "Python 学习"
  输出: [{id: "0923_Python", topic: "Python 学习", score: 1.0, is_gold: False}]

验收标准：
- 相关结果排在前面
- GOLD 结果权重更高

---

F3.1 关键词搜索召回
-------------------

描述：根据关键词召回相关记忆

输入：
  - query: 字符串，搜索词
  - max_results: 整数，最大返回数（默认 3）
  - max_tokens: 整数，最大 tokens（默认 1000）

输出：
  - List[RecallResult]: [{session_id, relevance, content, source, metadata}]

流程：
  1. 读取今日索引
  2. 搜索索引关键词
  3. 加载相关 Session
  4. 提取相关内容片段
  5. 按相关度排序
  6. 返回结果

示例：
  输入: query = "列表推导式"
  输出: [{session_id: "0923_Python", relevance: 0.95, content: "今天学习了列表推导式", ...}]

验收标准：
- 召回准确率 > 80%
- 每条结果 < 500 tokens

---

F4.1 内容标记
-------------

描述：将内容标记为 GOLD

输入：
  - content: 字符串

格式：
  在写入内容前添加 #GOLD 前缀

示例：
  输入: content = "使用 ChromaDB 作为向量库"
  存储: "\n\n#GOLD 使用 ChromaDB 作为向量库\n"

验收标准：
- 标记正确添加
- 与普通内容区分

---

F5.1 定时 Flush
---------------

描述：每日自动 Flush

输入：
  - 无（从配置读取时间）

配置项：
```yaml
flush:
  enabled: true
  time: "03:00"       # 每日凌晨 3 点
  archive_monthly: true
```

流程：
  1. 读取配置时间
  2. 到达时间触发
  3. 收集所有活跃 Session
  4. 移动到月度归档目录
  5. 创建新的索引文件

归档格式：
  源: memory/90_Memory/2026-02-07/session_0923_Python.md
  目标: memory/90_Memory/2026-02/session_0923_Python.md

验收标准：
- 文件正确移动
- 索引正确重置
- 历史可查询

================================================================================
5. 数据规格
================================================================================

5.1 文件命名规范
---------------

Session 文件:
  格式: session_HHMM_Topic.md
  示例: session_0923_Python学习.md

索引文件:
  格式: _INDEX.md 或 _DAILY_INDEX.md
  示例: memory/90_Memory/2026-02-07/_INDEX.md

归档目录:
  格式: YYYY-MM
  示例: memory/90_Memory/2026-02/

5.2 文件格式
-----------

A. Session 文件格式
-------------------

```markdown
---
uuid: 20260207092300
type: session
tags: [Python学习, 编程]
status: active
created: 2026-02-07T09:23:00
---

# Python学习

今天开始学习 Python。

## 第一节：基础语法

Python 是一门解释型语言。

#GOLD 使用 ChromaDB 作为向量库

继续学习列表...
```

字段说明:
  - uuid: 唯一标识，格式 YYYYMMDDHHmmss
  - type: 类型，固定为 "session"
  - tags: 标签列表
  - status: 状态 (active/paused/archived)
  - created: 创建时间 ISO 格式

B. 索引文件格式
---------------

```markdown
---
uuid: 20260207000000
type: daily-index
tags: [daily-index, 2026-02-07]
created: 2026-02-07
---

# 2026-02-07 Daily Index

## Sessions (3)
- [active] session_0923_Python学习 (Python学习)
- [active] session_1015_数学复习 (数学复习)
- [paused] session_0830_项目规划 (项目规划)

## Gold Keys (2)
- session_0923_Python学习: ChromaDB, 向量库
- session_0830_项目规划: v2.0, 目标

## Topics (2)
- Python学习
- 数学复习

---
updated: 2026-02-07T10:30:00
```

5.3 数据字典
------------

A. SessionMetadata
------------------

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| uuid | string | 是 | 唯一标识 |
| topic | string | 是 | 话题名称 |
| created_at | string | 是 | 创建时间 |
| last_active | string | 否 | 最后活跃 |
| status | enum | 是 | 状态 |
| gold_count | int | 否 | GOLD 数量 |
| word_count | int | 否 | 字数 |
| tags | list | 否 | 标签 |

B. RecallResult
---------------

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| session_id | string | 是 | Session ID |
| relevance | float | 是 | 相关度 0-1 |
| content | string | 是 | 召回内容 |
| source | string | 是 | 文件路径 |
| metadata | dict | 否 | 元数据 |

5.4 容量规划
------------

| 项目 | 大小 | 说明 |
|------|------|------|
| 单个索引 | < 1 KB | < 300 tokens |
| 单个 Session | < 50 KB | 自动分割 |
| 月度归档 | < 100 MB | 约 2000 Sessions |
| 年度归档 | < 1.2 GB | 可按年清理 |

================================================================================
6. API 接口
================================================================================

6.1 Python API
---------------

class NexusCore
═════════════════════════════════════════════════════════════════════════════

构造函数:
  NexusCore(config: NexusConfig = None)

─────────────────────────────────────────────────────────────────────

1. start_session(topic: str, auto_create: bool = True) -> str
   ────────────────────────────────────────────────────────────────
   功能: 创建新 Session
   输入: topic 话题名
   输出: session_id
   示例: nexus.start_session("Python学习")

─────────────────────────────────────────────────────────────────────

2. write_session(
     session_id: str,
     content: str,
     is_gold: bool = False,
     append: bool = True
   ) -> bool
   ────────────────────────────────────────────────────────────────
   功能: 写入 Session
   输入: session_id, content, is_gold, append
   输出: 是否成功
   示例: nexus.write_session("0923_Python", "今天学习...")

─────────────────────────────────────────────────────────────────────

3. read_session(session_id: str, max_tokens: int = None) -> Optional[str]
   ────────────────────────────────────────────────────────────────
   功能: 读取 Session
   输入: session_id, max_tokens
   输出: 内容或 None
   示例: content = nexus.read_session("0923_Python", 500)

─────────────────────────────────────────────────────────────────────

4. recall(query: str, max_results: int = 3, max_tokens: int = None) -> List[RecallResult]
   ────────────────────────────────────────────────────────────────
   功能: 召回相关记忆
   输入: query, max_results, max_tokens
   输出: RecallResult 列表
   示例: results = nexus.recall("列表推导式", 3)

─────────────────────────────────────────────────────────────────────

5. read_today_index() -> str
   ────────────────────────────────────────────────────────────────
   功能: 读取今日索引
   输入: 无
   输出: 索引内容
   示例: index = nexus.read_today_index()

─────────────────────────────────────────────────────────────────────

6. parse_index(index_content: str = None) -> DailyIndex
   ────────────────────────────────────────────────────────────────
   功能: 解析索引
   输入: index_content
   输出: DailyIndex 对象
   示例: daily = nexus.parse_index()

─────────────────────────────────────────────────────────────────────

7. flush_session(session_id: str) -> bool
   ────────────────────────────────────────────────────────────────
   功能: Flush 单个 Session
   输入: session_id
   输出: 是否成功
   示例: nexus.flush_session("0923_Python")

─────────────────────────────────────────────────────────────────────

8. daily_flush() -> Dict
   ────────────────────────────────────────────────────────────────
   功能: 执行每日 Flush
   输入: 无
   输出: 统计信息
   示例: stats = nexus.daily_flush()

─────────────────────────────────────────────────────────────────────

9. get_active_session() -> Optional[str]
   ────────────────────────────────────────────────────────────────
   功能: 获取活跃 Session
   输入: 无
   输出: session_id 或 None
   示例: session_id = nexus.get_active_session()

─────────────────────────────────────────────────────────────────────

10. get_stats() -> Dict
    ────────────────────────────────────────────────────────────────
   功能: 获取统计信息
   输入: 无
   输出: 统计字典
   示例: stats = nexus.get_stats()

6.2 CLI 接口
-----------

命令行用法:
  python nexus_core.py [命令] [参数]

命令:
  --init          初始化系统
  --stats         显示统计
  --session TOPIC  创建新 Session
  --write CONTENT  写入内容
  --recall QUERY   召回记忆
  --index         显示索引
  --flush         执行 Flush

示例:
  python nexus_core.py --session "Python学习"
  python nexus_core.py --recall "列表推导式"

================================================================================
7. 集成规格
================================================================================

7.1 OpenClaw 集成
-----------------

集成点: AGENTS.md

修改内容:
```markdown
# Deep-Sea Nexus v2.0 集成

## 启动规则
1. 启动时只读 `_DAILY_INDEX.md`
2. 不加载任何 Session 历史

## 对话规则
1. 用户提问时调用 `nexus.recall(query)`
2. 只加载相关内容 (< 500 tokens)
3. 不注入完整上下文

## 写入规则
1. 关键信息添加 `#GOLD` 标记
2. 每次交互后调用 `nexus.write_session()`

## Session 规则
1. 每个话题一个 Session
2. Session 格式: `session_HHMM_Topic.md`
3. 自动 Flush: 每日 03:00
```

7.2 文件位置
-----------

OpenClaw 目录:
  ~/.openclaw/workspace/DEEP_SEA_NEXUS_V2/

集成文件:
  - nexus_core.py
  - config.yaml
  - AGENTS.md (修改)

7.3 环境变量
-----------

| 变量 | 说明 | 默认值 |
|------|------|--------|
| NEXUS_PATH | Nexus 根路径 | ~/.openclaw/workspace/DEEP_SEA_NEXUS_V2 |
| NEXUS_MEMORY | 记忆目录 | memory/90_Memory |
| NEXUS_FLUSH_TIME | Flush 时间 | 03:00 |

================================================================================
8. 非功能规格
================================================================================

8.1 性能要求
-----------

| 场景 | 指标 | 说明 |
|------|------|------|
| 启动 | < 1 秒 | 加载索引 |
| 召回 | < 100ms | 搜索 + 加载 |
| 写入 | < 50ms | 追加 + 索引 |
| Flush | < 5 秒 | 归档所有 Session |

8.2 可靠性要求
-------------

| 场景 | 要求 | 处理 |
|------|------|------|
| 文件损坏 | 索引文件损坏 | 重建索引 |
| 磁盘满 | 存储空间不足 | 报警 |
| 并发写入 | 多线程同时写 | 文件锁 |

8.3 安全性要求
--------------

- 本地存储，无网络
- 用户数据不出本地
- 无敏感信息传输

8.4 兼容性要求
--------------

- Python 3.10+
- macOS/Linux
- 兼容现有记忆文件

================================================================================
9. 测试规格
================================================================================

9.1 测试策略
-----------

测试金字塔:
```
        ┌─────────┐
        │  E2E    │  端到端测试
       ┌┴─────────┴┐
       │  集成测试  │
      ┌┴─────────┴┐
      │   单元测试  │
     ┌┴─────────┴┐
     │   代码测试  │
    ┌┴─────────┴┐
    │   静态分析  │
   └────────────┘
```

9.2 测试用例
-----------

T1. 单元测试 (单元测试框架: pytest)
─────────────────────────────────────

| 用例 ID | 用例名称 | 输入 | 预期输出 |
|---------|----------|------|----------|
| UT01 | 创建 Session | topic="Test" | session_id 有效 |
| UT02 | 写入 Session | content="测试" | 文件包含内容 |
| UT03 | 读取 Session | session_id | 返回正确内容 |
| UT04 | 召回记忆 | query="测试" | 返回相关结果 |
| UT05 | GOLD 标记 | is_gold=True | 索引更新 |
| UT06 | Flush | session_id | 文件移动 |
| UT07 | 索引解析 | index_content | DailyIndex 正确 |
| UT08 | 配置加载 | config.yaml | 配置正确读取 |

验收标准: 100% 通过

T2. 集成测试
─────────────────────────────────────

| 用例 ID | 用例名称 | 场景 | 预期 |
|---------|----------|------|------|
| IT01 | 完整对话流程 | 创建→写入→召回 | 全流程正常 |
| IT02 | 多 Session | 创建 3 个 Session | 索引正确 |
| IT03 | GOLD 同步 | 标记后查询 | GOLD 优先 |
| IT04 | Flush 流程 | 触发 Flush | 归档正确 |
| IT05 | 索引大小验证 | 多次操作后 | < 300 tokens |

验收标准: 100% 通过

T3. 性能测试
─────────────────────────────────────

| 用例 ID | 指标 | 目标 | 验收 |
|---------|------|------|------|
| PT01 | 启动时间 | < 1s | ✓ |
| PT02 | 召回延迟 | < 100ms | ✓ |
| PT03 | 索引大小 | < 300t | ✓ |
| PT04 | 每轮消耗 | < 1000t | ✓ |

9.3 测试数据
-----------

测试 Session:
  - 10 个不同话题的 Session
  - 每个 Session 100-500 字
  - 3-5 个 GOLD 标记

测试查询:
  - 20 个测试查询
  - 覆盖不同话题
  - 包含模糊查询

================================================================================
10. 部署规格
================================================================================

10.1 环境要求
-------------

| 要求 | 规格 |
|------|------|
| Python | 3.10+ |
| 内存 | > 256MB |
| 磁盘 | > 1GB |
| 系统 | macOS / Linux |

10.2 目录结构
-------------

部署后:
```
~/.openclaw/workspace/
└── DEEP_SEA_NEXUS_V2/
    ├── nexus_core.py          # 核心脚本
    ├── config.yaml            # 配置文件
    ├── README.md              # 说明文档
    │
    ├── memory/
    │   └── 90_Memory/         # 记忆存储
    │       ├── _DAILY_INDEX.md
    │       ├── YYYY-MM-DD/
    │       └── YYYY-MM/
    │
    └── tests/                 # 测试套件
        ├── test_core.py
        └── test_recall.py
```

10.3 部署步骤
-------------

Step 1: 准备环境
  1. 确保 Python 3.10+ 安装
  2. 创建目录: mkdir -p ~/.openclaw/workspace/DEEP_SEA_NEXUS_V2

Step 2: 部署文件
  1. 复制 nexus_core.py
  2. 复制 config.yaml
  3. 设置权限: chmod +x nexus_core.py

Step 3: 初始化
  1. 运行: python nexus_core.py --init
  2. 验证索引创建

Step 4: 集成到 OpenClaw
  1. 修改 AGENTS.md
  2. 配置环境变量
  3. 测试集成

================================================================================
11. 里程碑
================================================================================

M1: 基础设施 (Day 1)
─────────────────────────────────────────────────────────────────
  - [ ] 目录结构创建
  - [ ] config.yaml 完成
  - [ ] 数据结构定义
  - [ ] 单元测试框架
  交付: 目录结构 + 配置 + 基础代码

验收: 所有目录存在，配置可读取

─────────────────────────────────────────────────────────────────

M2: Nexus Core (Day 2-3)
─────────────────────────────────────────────────────────────────
  - [ ] Config 类
  - [ ] Session 管理
  - [ ] 索引管理
  - [ ] 召回引擎
  - [ ] Flush 系统
  交付: nexus_core.py 完整功能

验收: 核心功能 100% 测试通过

─────────────────────────────────────────────────────────────────

M3: 工具脚本 (Day 4)
─────────────────────────────────────────────────────────────────
  - [ ] daily_flush.py
  - [ ] session_split.py
  - [ ] index_rebuild.py
  交付: 3 个工具脚本

验收: 脚本可独立运行

─────────────────────────────────────────────────────────────────

M4: 测试验证 (Day 5)
─────────────────────────────────────────────────────────────────
  - [ ] 单元测试
  - [ ] 集成测试
  - [ ] 性能测试
  - [ ] 人工验收
  交付: 测试报告

验收: 90%+ 测试通过

─────────────────────────────────────────────────────────────────

M5: 集成部署 (Day 6-7)
─────────────────────────────────────────────────────────────────
  - [ ] 修改 AGENTS.md
  - [ ] 集成到 OpenClaw
  - [ ] 文档完善
  - [ ] 用户手册
  交付: 完整部署

验收: 与 OpenClaw 无缝集成

================================================================================
附录 A: 验收检查清单
================================================================================

最终交付检查:

基础
  [ ] 目录结构符合规范
  [ ] config.yaml 语法正确
  [ ] Python 代码无语法错误

核心功能
  [ ] 创建 Session 正常
  [ ] 写入 Session 正常
  [ ] 读取 Session 正常
  [ ] 召回记忆正常
  [ ] GOLD 标记正常
  [ ] Flush 正常

性能
  [ ] 索引 < 300 tokens
  [ ] 启动 < 1 秒
  [ ] 召回 < 100ms

集成
  [ ] AGENTS.md 已修改
  [ ] CLI 可用
  [ ] Python API 可用

测试
  [ ] 单元测试 > 80% 覆盖
  [ ] 集成测试 100% 通过
  [ ] 性能测试达标

文档
  [ ] README.md 完整
  [ ] API 文档完整
  [ ] 部署说明清晰

================================================================================
附录 B: 风险评估
================================================================================

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| 索引损坏 | 低 | 高 | 自动重建 |
| 磁盘满 | 中 | 中 | 定期清理 |
| 性能不达标 | 中 | 中 | 优化代码 |
| 集成困难 | 低 | 中 | 提供详细文档 |

================================================================================
附录 C: 后续版本规划
================================================================================

v3.0 (后续)
  - MCP 协议支持
  - 智能摘要
  - 代码调试模式
  - 语义搜索（可选）

================================================================================

文档结束
```

